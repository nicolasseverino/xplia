<!DOCTYPE html>
<html lang="{{ language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - {{ organization }}</title>
    <style>
        :root {
            --primary-color: #005EB8;  /* Bleu médical NHS */
            --secondary-color: #41B6E6;
            --accent-color: #AE2573;  /* Violet médical */
            --text-color: #212B32;
            --light-bg: #F0F4F5;
            --warning-color: #ED8B00;
            --success-color: #007F3B;
            --critical-color: #DA291C;
        }
        
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title h1 {
            font-size: 28px;
            margin: 0;
        }
        
        .header-title p {
            margin: 5px 0 0 0;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .logo {
            max-width: 150px;
            max-height: 80px;
        }
        
        .metadata {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
            margin: 30px 0;
        }
        
        .metadata-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .metadata-label {
            font-weight: bold;
            width: 150px;
            color: var(--primary-color);
        }
        
        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
            margin-top: 40px;
        }
        
        h3 {
            color: var(--secondary-color);
        }
        
        .score-container {
            text-align: center;
            background-color: var(--light-bg);
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .score-value {
            font-size: 72px;
            font-weight: bold;
            color: var(--primary-color);
            line-height: 1;
        }
        
        .score-label {
            font-size: 18px;
            color: var(--text-color);
            margin-top: 10px;
        }
        
        .compliance-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .status-compliant {
            background-color: var(--success-color);
            color: white;
        }
        
        .status-partial {
            background-color: var(--warning-color);
            color: white;
        }
        
        .status-non-compliant {
            background-color: var(--critical-color);
            color: white;
        }
        
        .chart-container {
            height: 400px;
            margin: 40px 0;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: normal;
        }
        
        tr:hover {
            background-color: #f5f9fc;
        }
        
        .issue {
            background-color: white;
            margin-bottom: 20px;
            padding: 20px;
            border-left: 5px solid var(--critical-color);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }
        
        .issue-high {
            border-left-color: var(--critical-color);
        }
        
        .issue-medium {
            border-left-color: var(--warning-color);
        }
        
        .issue-low {
            border-left-color: var(--secondary-color);
        }
        
        .issue h3 {
            margin-top: 0;
            color: var(--text-color);
        }
        
        .issue-severity {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .severity-high {
            background-color: var(--critical-color);
            color: white;
        }
        
        .severity-medium {
            background-color: var(--warning-color);
            color: white;
        }
        
        .severity-low {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .recommendation {
            background-color: white;
            margin-bottom: 15px;
            padding: 15px 20px;
            border-left: 5px solid var(--success-color);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }
        
        .hipaa-badge, .gdpr-badge, .aiact-badge {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .hipaa-badge {
            background-color: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #2E7D32;
        }
        
        .gdpr-badge {
            background-color: #E3F2FD;
            color: #1565C0;
            border: 1px solid #1565C0;
        }
        
        .aiact-badge {
            background-color: #F3E5F5;
            color: #6A1B9A;
            border: 1px solid #6A1B9A;
        }
        
        .verification-section {
            text-align: center;
            margin: 40px 0;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }
        
        .qr-code {
            max-width: 200px;
            margin: 20px auto;
        }
        
        .signature-section {
            margin: 40px 0;
            padding: 20px;
            background-color: var(--light-bg);
            border: 1px solid #ddd;
            font-family: monospace;
        }
        
        footer {
            margin-top: 50px;
            padding: 20px;
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            font-size: 14px;
        }
        
        /* Ajouts spécifiques au secteur médical */
        .medical-info {
            background-color: #E3F2FD;
            border-left: 4px solid #1565C0;
            padding: 15px;
            margin: 20px 0;
        }
        
        .medical-warning {
            background-color: #FFEBEE;
            border-left: 4px solid #C62828;
            padding: 15px;
            margin: 20px 0;
        }
        
        .medical-compliance {
            background-color: #E8F5E9;
            border-left: 4px solid #2E7D32;
            padding: 15px;
            margin: 20px 0;
        }
        
        .regulation-badges {
            margin: 20px 0;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            
            .chart-container {
                break-inside: avoid;
            }
            
            h2, h3 {
                break-after: avoid;
            }
            
            .issue, .recommendation {
                break-inside: avoid;
            }
            
            tr {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>{{ title }}</h1>
                    <p>{{ timestamp }}</p>
                </div>
                {% if logo_path %}
                <img src="{{ logo_path }}" alt="Logo" class="logo">
                {% endif %}
            </div>
        </header>
        
        <section class="metadata">
            <div class="metadata-row">
                <div class="metadata-label">{{ organization_label }}:</div>
                <div>{{ organization }}</div>
            </div>
            <div class="metadata-row">
                <div class="metadata-label">{{ responsible_label }}:</div>
                <div>{{ responsible }}</div>
            </div>
            <div class="metadata-row">
                <div class="metadata-label">{{ date_label }}:</div>
                <div>{{ formatted_date }}</div>
            </div>
        </section>
        
        <div class="regulation-badges">
            <span class="hipaa-badge">HIPAA</span>
            <span class="gdpr-badge">RGPD</span>
            <span class="aiact-badge">AI Act</span>
        </div>
        
        <div class="medical-info">
            <p>Ce rapport évalue la conformité de vos systèmes d'IA dans le secteur médical selon les réglementations HIPAA, RGPD et AI Act. Une conformité totale est requise pour les systèmes traitant des données médicales sensibles.</p>
        </div>
        
        {% if summary %}
        <section>
            <h2>{{ summary_label }}</h2>
            <p>{{ summary }}</p>
        </section>
        {% endif %}
        
        {% if compliance_score %}
        <section>
            <h2>{{ compliance_score_label }}</h2>
            <div class="score-container">
                <div class="score-value">{{ score }}</div>
                <div class="score-label">Score global de conformité</div>
                <div class="compliance-status {% if score >= 90 %}status-compliant{% elif score >= 70 %}status-partial{% else %}status-non-compliant{% endif %}">
                    {{ compliance_status }}
                </div>
            </div>
            
            {% if score_details %}
            <div class="chart-container" id="scoreChart">
                <!-- Chart will be inserted here by JavaScript -->
            </div>
            
            <table>
                <tr>
                    <th>{{ regulation_label }}</th>
                    <th>{{ score_label }}</th>
                </tr>
                {% for regulation, score in score_details.items() %}
                <tr>
                    <td>{{ regulation }}</td>
                    <td>{{ score }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </section>
        {% endif %}
        
        <div class="medical-compliance">
            <p><strong>Exigences spécifiques au secteur médical :</strong> En plus des réglementations générales, ce rapport met en évidence la conformité aux exigences spéciales pour les systèmes de décision médicale et les solutions d'IA clinique.</p>
        </div>
        
        {% if audit_trail %}
        <section>
            <h2>{{ audit_trail_label }}</h2>
            <table>
                <tr>
                    {% for header in audit_trail_headers %}
                    <th>{{ header }}</th>
                    {% endfor %}
                </tr>
                {% for entry in audit_trail %}
                <tr>
                    {% for field, value in entry.items() %}
                    <td>{{ value }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </section>
        {% endif %}
        
        {% if decision_log %}
        <section>
            <h2>{{ decision_log_label }}</h2>
            <table>
                <tr>
                    {% for header in decision_log_headers %}
                    <th>{{ header }}</th>
                    {% endfor %}
                </tr>
                {% for entry in decision_log %}
                <tr>
                    {% for field, value in entry.items() %}
                    <td>{{ value }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </section>
        {% endif %}
        
        {% if issues %}
        <section>
            <h2>{{ issues_label }}</h2>
            <div class="medical-warning">
                <p><strong>Attention :</strong> Les non-conformités dans le secteur médical peuvent avoir un impact direct sur la sécurité des patients et la protection des données de santé. Chaque problème identifié doit être traité selon son niveau de criticité.</p>
            </div>
            
            {% for issue in issues %}
            <div class="issue issue-{% if issue.severity == 'high' %}high{% elif issue.severity == 'medium' %}medium{% else %}low{% endif %}">
                <h3>{{ issue.title }}</h3>
                <span class="issue-severity severity-{% if issue.severity == 'high' %}high{% elif issue.severity == 'medium' %}medium{% else %}low{% endif %}">{{ issue.severity }}</span>
                <p><strong>{{ description_label }}:</strong> {{ issue.description }}</p>
                {% if issue.regulation %}
                <p><strong>{{ regulation_label }}:</strong> {{ issue.regulation }}</p>
                {% endif %}
                {% if issue.remediation %}
                <p><strong>{{ remediation_label }}:</strong> {{ issue.remediation }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </section>
        {% endif %}
        
        {% if recommendations %}
        <section>
            <h2>{{ recommendations_label }}</h2>
            {% for recommendation in recommendations %}
            <div class="recommendation">
                <p>{{ recommendation }}</p>
            </div>
            {% endfor %}
        </section>
        {% endif %}
        
        {% if include_verification_qr and verification_url %}
        <section class="verification-section">
            <h2>{{ verification_label }}</h2>
            <img src="{{ qr_code }}" alt="QR Code for verification" class="qr-code">
            <p>{{ verification_instruction }}</p>
        </section>
        {% endif %}
        
        {% if include_signatures %}
        <section class="signature-section">
            <h2>{{ signature_label }}</h2>
            <p><strong>{{ signature_value_label }}:</strong> {{ signature_value }}</p>
            <p><strong>{{ signature_timestamp_label }}:</strong> {{ signature_timestamp }}</p>
        </section>
        {% endif %}
        
        <footer>
            <p>{{ footer_text }}</p>
            <p>{{ generator_info }}</p>
        </footer>
    </div>
    
    {% if include_charts %}
    <script>
        // Script qui sera injecté pour les graphiques
        // Exemple avec Chart.js (à inclure comme dépendance)
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('scoreChart')) {
                // Code pour générer les graphiques
            }
        });
    </script>
    {% endif %}
</body>
</html>
